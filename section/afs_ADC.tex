\section{Analog til Digital Converter (ADC)}
I dette afsnit vil de forskellige former for analoge til digitale konvertere, som er anvendt, blive beskrevet. 

\subsection{Diskret BMS}
I den diskrete version af BMS'en er der en del analoge værdier som skal læses. Dette er lige fra cellespændinger til strømmåleren. Derfor bruges en ADC (Analog til Digital Converter) til at konvertere disse spændingsværdier til data som microcontrolleren kan behandle.
\\

Hardwaren i afsnit \ref{sec:cell_voltage}, giver et spændingsinterval passende til microcontrollerens ADC, svingende mellem $2.176\volt$ og $2.822\volt$. Intervallet på $646\milli\volt$ skal af microcontrolleren tolkes som henholdsvis $3.2\volt$ og $4.15\volt$.
\\

For at finde den rigtige cellespænding gennem ADC'en, anvendes  forstærkningen af operationsforstærkeren internt i microcontrolleren,

\begin {equation}
V_{cell} =  \frac{ADC(cell)}{0.68}
\end {equation}

%Som tidligere nævnt bliver cellespændingen læst vha. operationsforstærkere med negativt gain. Da cellerne kan lades op til $4.2\volt$ går de over microcontrollerens niveau på $3.3\volt$ og derfor skal det konverteres ned.



% \sbf{Tilpas HVORFOR det er 600mv} Dette giver et arbejdspunkt på 600mv. Her laves en simpel analog til digital konvertering på hvert enkelt indgang som cellerne er sluttet til. Denne værdi ganges med en faktor for at give den præcise spænding, som er kalibreret vha. måling. 
%\begin {equation}
%V_{cell} = ADC(cell) \times 7
%\end {equation}
%hvor 7 er fundet vha. måling og sammenligning af de to værdier. \\

Til strømmåleren anvendes også analog til digital konvertering. Her bruges dog både en kanal til måling af opladestrømmen og afladestrømmen.
 
\sbf{Forklar hvordan det virker med opløsning. altså hvorfor en adc værdi på 1 er lig med 0,5mv, efter gain på 0,68 er ganget på.}
\sbf{Strømmåler forklaring. samme princip med gain}

\subsection{Integreret BMS}
I den integrerede kreds sidder der en 14-bit's ADC som tager målinger af både cellespændinger, eventuelle eksterne thermistorer, og interne temperaturer. Cellespændingerne bliver læst i 2-komplement formatet og i $\milli\volt$. Formlen for at omregne disse værdier er således: 
\begin {equation} 
V_{cell} = GAIN \times ADC(cell) + OFFSET
\end {equation}
Ifølge databladet\footnote{\url{http://www.ti.com/lit/ds/symlink/bq76920.pdf} side 22-23} er $GAIN$ på $380\micro\volt/LSB$ og $OFFSET$ er på $30\milli\volt$. \\

Derfor, hvis der læses $0x1F10$ fra registrene $VC1_{HI}$ og $VC1_{LO}$ ($0x0C$ og $0x0D$) giver det en cellespænding på $3052\milli\volt$ eller $3,052\volt$.\\

For at lave strømmåling er der også en 16-bit's integrerende ADC som måler på shunt modstanden. Værdien udlæses fra IC'en i et 16-bit 2's complement format og da ADC'en måler spændingsfaldet over modstanden, angiver den resultatet i $\micro\volt$. Derfor, for at omregne til strømforbrug ganges der en faktor\footnote{\url{http://www.ti.com/lit/ds/symlink/bq76920.pdf} side 25} på: 
\begin {equation} 
I = ADC(Shunt) \times 8.44\micro\volt/LSB
\end {equation}

Derfor, hvis der læses $0x0C08$ fra registrene $CC_{HI}$ og $CC_{LO}$ ($0x32$ og $0x33$) giver det et aktuelt strømforbrug på $25995*10^{-4}\ampere$ eller $2.5995\ampere$.